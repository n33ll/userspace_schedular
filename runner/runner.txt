#include "runner.h"
#include <emmintrin.h>

template <typename F>
runner<F>::runner(queue<fiber_t<F>*>* q, int id){
    _queue = q;
    _runner_id = id;
}

template <typename F>
void runner<F>::run(){
    while(true){
        fiber_t<F>* f;
        
        if(!_queue->dequeue(f)){
            if(_queue->is_closed()){
                return;
            }
            _mm_pause();
            continue;
        }

        //execute the fiber
        f->ctx.resume();
    }
}

